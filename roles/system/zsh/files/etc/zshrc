# =============================================================================
# ZSH SYSTEM CONFIGURATION (/etc/zshrc)
# =============================================================================
# Global configuration for all system users
# This file is loaded before ~/.zshrc

# -----------------------------------------------------------------------------
# ENVIRONMENT VARIABLES
# -----------------------------------------------------------------------------
# System paths
export PATH="/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin"
export MANPATH="/usr/local/man:/usr/share/man"

# Default editor (global)
if command -v nvim >/dev/null 2>&1; then
    export EDITOR="nvim"
    export VISUAL="nvim"
else
    export EDITOR="vim"
    export VISUAL="vim"
fi

# Security settings
umask 022 # Set umask (set file permissions by default)

# -----------------------------------------------------------------------------
# SHELL OPTIONS (Basic configuration)
# -----------------------------------------------------------------------------
# Basic options for all users
setopt nobeep                       # Disable beep
setopt notify                       # Notify when jobs finish
setopt numericglobsort              # Sort wildcards numerically
setopt autocd                       # Auto cd
setopt nonomatch                    # Disable nonomatch
setopt promptsubst                  # Enable prompt substitution
setopt clobber                      # Allow clobbering files
unsetopt hup                        # Disable hup (on terminal close, do not kill processes)
unset list_ambiguous                # Disable list ambiguous

# -----------------------------------------------------------------------------
# HISTORY (Global configuration)
# -----------------------------------------------------------------------------
HISTSIZE=10000                      # History size in session
SAVEHIST=10000                      # Saved history size
HISTFILE=~/.config/zsh/.zsh_history # History file
setopt appendhistory                # Append to history
setopt sharehistory                 # Share history between terminals
setopt hist_ignore_space            # Ignore commands starting with space
setopt hist_ignore_dups             # Ignore duplicate entries
setopt hist_ignore_all_dups         # Ignore all duplicate entries
setopt hist_save_no_dups            # Do not save duplicate entries
setopt hist_find_no_dups            # Do not find duplicate entries
setopt hist_ignore_space            # Ignore commands starting with space

# -----------------------------------------------------------------------------
# COMPLETION (Basic configuration)
# -----------------------------------------------------------------------------
autoload -U compinit
compinit -d ~/.config/zsh/.zcompdump

# Basic completion configuration
zstyle ':completion:*' use-compctl false                                    # Use compctl for completion
zstyle ':completion:*' verbose true                                         # Verbose completion
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'                   # Matcher list

# Advanced completion configuration
zstyle ':completion:*' completer _expand _complete _correct _approximate    # Completer configuration
zstyle ':completion:*' menu select=2                                        # Selection menu
zstyle ':completion:*' group-name ''                                        # Group name
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}                       # List colors
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}' '+m:{A-Z}={a-z}'  # Matcher list
zstyle ':completion:*' accept-exact '*(N)'                                  # Accept exact

# Configuration for word-by-word navigation
zstyle ':completion:*' insert-tab pending                                   # Tab inserts first match
zstyle ':completion:*' list-prompt ''                                       # No list prompt
zstyle ':completion:*' select-prompt ''                                     # No selection prompt

# Specific completions
zstyle ':completion:*:sudo:*' command-path /usr/local/sbin /usr/local/bin /usr/sbin /usr/bin /sbin /bin # Sudo completion: search commands in system paths
zstyle ':completion:*:kill:*' command 'ps -u $USER -o pid,%cpu,tty,cputime,cmd'                         # Kill completion: show process info with PID, CPU, TTY, time and command
zstyle ':completion:*:kill:*' insert-ids single                                                         # Kill completion: insert only one process ID at a time

# -----------------------------------------------------------------------------
# KEYBINDINGS (Global)
# -----------------------------------------------------------------------------
bindkey -e                          # Emacs-style keybindings

# Navigation in completions
bindkey '^[[1;5C' forward-word     # Ctrl+Right arrow (next word)
bindkey '^[[1;5D' backward-word    # Ctrl+Left arrow (previous word)
bindkey '^[[5C' forward-word       # Alternative Ctrl+Right arrow
bindkey '^[[5D' backward-word      # Alternative Ctrl+Left arrow

# -----------------------------------------------------------------------------
# SYSTEM FUNCTIONS
# -----------------------------------------------------------------------------
# Load system functions
[[ -f /etc/zsh/zfunctions ]] && source /etc/zsh/zfunctions
[[ -f /etc/zsh/zremote ]] && source /etc/zsh/zremote
[[ -f /etc/zsh/zshvenv ]] && source /etc/zsh/zshvenv