# -*- coding: utf-8 -*-
# ZSH Auto-Detection Functions
# Functions for automatically detecting VENV and Git repositories

# Python Virtual Environments Auto-Detection
_auto_detect_venvs() {
    local venv_dir="$HOME/.venv"
    
    if [[ -d "$venv_dir" ]]; then
        # Scan all subdirectories in .venv
        for venv_path in "$venv_dir"/*/; do
            if [[ -d "$venv_path" ]] && [[ -f "${venv_path}bin/activate" ]]; then
                local venv_name=$(basename "$venv_path")
                
                # Create alias for this virtual environment (prefixed with 'v' for Virtual)
                alias "v$venv_name"="source $venv_path/bin/activate"
                
                # Show detected environments (only once)
                if [[ -z "$VENV_DETECTION_SHOWN" ]]; then
                    echo "üêç Virtual environments detected: $venv_name"
                    export VENV_DETECTION_SHOWN=1
                else
                    echo "   + $venv_name"
                fi
            fi
        done
        
        # Show usage instructions
        if [[ -n "$VENV_DETECTION_SHOWN" ]]; then
        fi
    fi
}

# Git Repositories Auto-Detection
_auto_detect_git_repos() {
    # Initialize empty array
    local git_repos=()
    
    # Use find to scan recursively for .git directories
    while IFS= read -r -d '' repo_path; do
        # Remove the /.git suffix to get the repository root
        repo_path="${repo_path%/.git}"
        
        if [[ -d "$repo_path" ]] && [[ -d "$repo_path/.git" ]]; then
            local repo_name=$(basename "$repo_path")
            
            # Add to array
            git_repos+=("$repo_name")
            
            # Create alias for this Git repository (prefixed with 'g' for Git)
            alias "g$repo_name"="cd $repo_path"
        fi
    done < <(find "$HOME" -maxdepth 3 -type d -name ".git" -print0 2>/dev/null)
    
    # Count repositories using alternative method to avoid Jinja2 issues
    local repo_count=0
    for repo in "${git_repos[@]}"; do
        ((repo_count++))
    done
    
    if [[ $repo_count -gt 0 ]]; then
        echo "üìÅ Git repositories detected: $repo_count"
        for repo in "${git_repos[@]}"; do
            echo "   + $repo"
        done
    fi
}

# Execute auto-detection functions
_auto_detect_venvs
_auto_detect_git_repos
