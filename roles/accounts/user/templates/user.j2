# -*- coding: utf-8 -*-
# User Personal ZSH Configuration - Generated by Ansible
# User: {{ user.name }}

# =============================================================================
# 1. SSH AGENT MANAGEMENT
# =============================================================================

# SSH Agent Management
SSH_AGENT_CONF="$HOME/.ssh/agent"

# If agent config exists, source it to restore existing agent
if [[ -e "$SSH_AGENT_CONF" ]]; then
    . "$SSH_AGENT_CONF" >/dev/null 2>&1
fi

# If no keys are loaded, start a new agent and add private keys
if ! ssh-add -l >/dev/null 2>&1; then
    if ssh-agent >| "$SSH_AGENT_CONF" 2>/dev/null; then
        . "$SSH_AGENT_CONF" >/dev/null 2>&1
        
        # Add SSH keys if defined
{% if user.ssh is defined and user.ssh['keys'] is defined and user.ssh['keys'] is iterable %}
{% for key in user.ssh['keys'] %}
        [[ -f "$HOME/.ssh/{{ key }}" ]] && ssh-add "$HOME/.ssh/{{ key }}" 2>/dev/null
{% endfor %}
{% endif %}
    else
        echo "Warning: Could not start SSH agent" >&2
    fi
fi