# -*- coding: utf-8 -*-
# User Main ZSH Configuration - Generated by Ansible
# User: {{ user.name }}

# =============================================================================
# 1. ENVIRONMENT SETUP
# =============================================================================

# Add local binaries to PATH
export PATH="$PATH:$HOME/.local/bin"

# =============================================================================
# 2. DEVELOPMENT TOOLS
# =============================================================================

# Ansible Configuration
if command -v ansible >/dev/null 2>&1; then
    export ANSIBLE_CALLBACKS_ENABLED=profile_tasks
fi

# =============================================================================
# 3. SECURITY & AUTHENTICATION
# =============================================================================

# SSH Agent Management
SSH_AGENT_CONF="$HOME/.ssh/agent"

# If agent config exists, source it to restore existing agent
if [[ -e "$SSH_AGENT_CONF" ]]; then
    . "$SSH_AGENT_CONF" >/dev/null 2>&1
fi

# If no keys are loaded, start a new agent and add private keys
if ! ssh-add -l >/dev/null 2>&1; then
    if ssh-agent >| "$SSH_AGENT_CONF" 2>/dev/null; then
        . "$SSH_AGENT_CONF" >/dev/null 2>&1
        
        # Add SSH keys if defined
        {% if user.ssh is defined and user.ssh['keys'] is defined and user.ssh['keys'] is iterable %}
        {% for key in user.ssh['keys'] %}
        [[ -f "$HOME/.ssh/{{ key }}" ]] && ssh-add "$HOME/.ssh/{{ key }}" 2>/dev/null
        {% endfor %}
        {% endif %}
    else
        echo "Warning: Could not start SSH agent" >&2
    fi
fi

# =============================================================================
# 4. USER CUSTOMIZATION
# =============================================================================

# User-specific aliases and environment variables
# Add your custom configuration below:

# Example aliases:
# alias myproject='cd $HOME/projects/myproject'
# alias deploy='ansible-playbook deploy.yml'

# Example environment variables:
# export PROJECT_HOME="$HOME/projects"
# export API_KEY="your-api-key-here"

# =============================================================================
# 5. SESSION INITIALIZATION
# =============================================================================

# Display welcome message only once per session
if [[ -z "$ZSH_WELCOME_DISPLAYED" ]]; then
    echo "Welcome {{ user.name }}! ZSH configuration loaded successfully."
    export ZSH_WELCOME_DISPLAYED=1
fi
